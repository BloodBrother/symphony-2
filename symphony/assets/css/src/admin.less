/**
 * Symphony Admin Master Layout
 */

/* Less variables --------*/
@import "variables";

/* Master grid layout --------*/
body {
	display: grid;
	grid-template-areas: 
		"header context context session"
		"notifier notifier notifier notifier"
		"primary primary primary primary"
		"secondary secondary secondary secondary"
		"footer footer footer footer"
		"nav nav controls controls";
		grid-template-rows: 
			var(--spacing-broadest) 
			auto
			minmax(0, 1fr)
			auto
			auto 
			var(--spacing-broadest);
		grid-template-columns: min-content auto minmax(0, 1fr) auto;

/* Zap structural elements to get children on master grid --------*/
	>main, >header, >header>h1, >main>form {
		display: contents;
	}
	
	/* Master Layout Base --------*/
	>nav {
		max-width: 100%;
		overflow: auto;
	}

	>.notifier {
		grid-area: notifier;
	}

	>header>h1>a {
		grid-area: header;
		padding: var(--standard-inner-rhythm);
	}

	[id="session"] {
		grid-area: session;
	}

	>nav {
		grid-area: nav;
		padding: var(--standard-outer-rhythm);
		padding-top: var(--spacing-large);
		padding-left: calc(var(--standard-outer-rhythm) + var(--standard-inner-rhythm));
	}

	>footer {
		grid-area: footer;
		padding: var(--standard-outer-rhythm);
	}

	>aside {
		grid-area: context;
		padding: var(--standard-inner-rhythm);
	}

	>main>form>* {
		position: relative;
	}

	[id="primary"],
	[id="secondary"] {
		display: flex;
		flex-direction: column;
	}

	[id="secondary"],
	>main>form~* {
		grid-area: secondary;
		border-left: 1px solid var(--color-ui);
		padding: var(--standard-outer-rhythm);
	}
	
	[id="primary"] {
		grid-area: primary;
		scroll-padding-top: calc(var(--standard-outer-rhythm) * 2);
	}


	[id="primary"]>[role="directory"] {
		flex-grow: 1;
	}

	[id="controls"] {
		grid-area: controls;
	}


	[id="context"],
	[id="nav"],
	[id="footer"],
	[id="session"],
	[id="header"],
	[id="header"] h1>a,
	[id="controls"],
	[id="secondary"] {
		background-color: var(--backframe-background-color);
	}

	[id="context"] {
		z-index: 5;
	}

	.notifier {
		z-index: 6;
	}

	[id="controls"] {
		z-index: 7;
	}

	#btn-toggle-header-mobile {
		grid-area: nav;
	}
	
	/* Master Layout for Narrow Viewports --------*/
	@media (max-width: @md) {
		>nav {
			/* Fix the nav and fit the screen --------*/
			position: fixed;
			top: 0;
			right: 0;
			bottom: 0;
			left: 0;
			/* Graphics --------*/
			background-color: var(--backframe-background-color);
			padding: var(--standard-outer-rhythm);

			// display: flex;
			// flex-direction: column;
			padding-top: var(--spacing-larger);
			z-index: 11;

			&:not(.is-opened) {
				opacity: 0;
				pointer-events: none;
			}
		}

		/* Create top bar --------*/
		>header>h1>a,
		[id="session"],
		[id="context"] {
			background-color: var(--backframe-background-color);
			z-index: 1;
		}

		/* Create bottom bar with grid-area items --------*/
		[id="controls"],
		#btn-toggle-header-mobile {

			/* Graphics --------*/
			background-color: var(--backframe-background-color);
			padding: var(--standard-inner-rhythm) var(--standard-outer-rhythm);
			border-top: 1px solid var(--color-ui);
			/* Make it stick to the bottom of the window --------*/
			position: sticky;
			bottom: 0;
			order: 3;
			/* Make sure we can align items --------*/
			display: flex;
			align-items: center;
			/* Make sure it's above the nav --------*/
			z-index: 12;
		}

		#btn-toggle-header-mobile {
			border-right: 1px solid var(--color-ui);
		}

		main>form>[id="primary"] {
			overflow: auto;
		}

		[id="controls"],
		[id="session"] {
			display: flex;
			justify-content: flex-end;
		}

		[id="session"]>ul {
			z-index: 2;
			bottom: auto;
			top: 100%;
		}

		>[id="footer"] {
			position: fixed;
			padding: var(--spacing-micro);
			bottom: var(--spacing-broadest);
			background-color: transparent;
		}
	}

	@media (min-width: @xs) {
		grid-template-areas: 
			"header header context session"
			"notifier notifier notifier notifier"
			"primary primary primary primary"
			"secondary secondary secondary secondary"
			"footer footer footer footer"
			"nav controls controls controls";
	}

	@media (min-width: @sm) {
		grid-template-areas: 
			"header header context session session session"
			"notifier notifier notifier notifier notifier notifier"
			"primary primary primary primary secondary-panel-switch secondary"
			"nav controls controls controls controls controls";
		grid-template-rows: 
			var(--spacing-broadest) auto minmax(0,1fr) var(--spacing-broadest);
		grid-template-columns: min-content auto minmax(0, 1fr) auto auto auto;


		[id="secondary"],
		>main>form~* {
			border-left: 1px solid var(--color-ui);
			
			width: var(--sidebar-width);
			max-width: var(--sidebar-max-width);
		}
	}

	/* Deployed grid layout for larger windows  --------*/
	@media (min-width: @md) {
		height: 100vh;
		grid-template-rows: auto auto 0 1fr min-content;
		grid-template-columns: 
			auto
			auto 
			minmax(0, 1fr)
			auto
			auto
			max-content;
		grid-template-areas:
			"header context context context secondary controls" 
			"nav context context context secondary controls"
			"nav nav-panel-switch notifier secondary-panel-switch secondary controls"
			"nav nav-panel-switch primary secondary-panel-switch secondary controls"
			"session nav-panel-switch primary secondary-panel-switch secondary controls"
			"footer nav-panel-switch primary secondary-panel-switch secondary controls";

		>main>form>section {
			max-height: 100%;
			overflow: auto;
		}

		>nav {
			width: var(--navigation-sidebar-width);
			max-width: var(--navigation-sidebar-max-width);
		}

		>header [id="session"] {
			padding-left: var(--standard-outer-rhythm);
		}

		>aside {
			border-left: 1px solid var(--color-ui);
			border-bottom: 1px solid var(--color-ui);
		}

		[id="primary"] {
			// border-left: 1px solid var(--color-ui);
		}

		[id="controls"] {
			flex-direction: column;
			border-left: 1px solid var(--color-ui);
			padding: var(--standard-inner-rhythm);
			padding-top: var(--standard-outer-rhythm);
		}
	}


	/* Content publishing interface specifics --------*/
	&[id="publish"].page-single {
		
		/* Align page title with primary fields --------*/
		[id="breadcrumbs"] {
			&:after {
				content: "";
			}
			nav, &:after {
				flex-basis: 0;
				flex-grow: 1;
			}

			h2 {
				margin: 0 auto;
				flex-basis: var(--standard-field-max-width);
			}
		}

		
		[id="primary"],
		[id="secondary"] {

			>* {
				flex-shrink: 0;

				@media (min-width: @md) {
					/* Forced vertical spacing in scrolling parent --------*/
					&:first-child {
						margin-top: auto;
					}

					&:last-child {
						margin-bottom: auto;
					}
				}
			}


			.field {
				max-width: var(--standard-field-max-width);
				width: 100%;
				margin-left: auto;
				margin-right: auto;

			}

		}

		[id="primary"] {
			padding: 0 var(--standard-outer-rhythm);

			/* Center fields vertically if in small quantities --------*/
			&:before, &:after {
				content: "";
				display: block;
				height: calc(var(--standard-outer-rhythm) * 2);
				flex-shrink: 0;
			}

			// .field {
			// 	--standard-field-background-color: var(--primary-field-background-color);
				

			// }

			@media (max-width: @sm) {
				&:last-of-type {
					min-height: 100%;
				}
			}

		}

		[id="secondary"] {

			// .field {
			// 	--standard-field-background-color: var(--secondary-field-background-color);
			// }

			@media (max-width: @sm) {
				// min-height: calc(100vh - var(--spacing-broadest));
				box-sizing: border-box;
				// position: sticky;
				// bottom: var(--spacing-broadest);

				// .field {
				// 	/* Center fields vertically if in small quantities --------*/
				// 	&:first-child {
				// 		margin-top: auto;
				// 	}

				// 	&:last-child {
				// 		margin-bottom: auto;
				// 	}
				// }
			}

		}
	}
}

/* Primary and secondary style variants --------*/
[id="primary"] {
	--standard-field-background-color: var(--primary-field-background-color);
}

[id="secondary"] {
	--standard-field-background-color: var(--secondary-field-background-color);
}

/* Panel display switches --------*/
input.nav-panel-switch,
input.secondary-panel-switch {
	-webkit-appearance: none;
	appearance: none;
	display: flex;
	width: var(--spacing-thin);
	align-items: center;
	justify-content: center;
	position: relative;
	align-self: stretch;
	color: var(--color-main-lighter);
	font-size: var(--text-small);
	background-color: var(--frontframe-background-color);
	// box-shadow: inset var(--shadow-small);

	&:hover {
		background-color: var(--color-accent-light);
	}

	&:not(:checked) {
		background-color: var(--color-accent-lighter);
	}
}

input.nav-panel-switch {
	grid-area: nav-panel-switch;
	border-left: 1px solid var(--color-ui);

	&:checked:before {
		content: "◀";
	}

	&:not(:checked):before {
		content: "▶";
	}

	@media (max-width: @md) {
		display: none;
	}
}

input.secondary-panel-switch {
	grid-area: secondary-panel-switch;
	border-left: 1px solid var(--color-ui);
	&:checked:before {
		content: "▶";
	}

	&:not(:checked):before {
		content: "◀";
	}

	@media (max-width: @sm) {
		display: none;
	}
}

@media (min-width: @sm) {
	input.secondary-panel-switch:not(:checked)~[id="secondary"],
	input.nav-panel-switch:not(:checked)~nav,
	input.nav-panel-switch:not(:checked)~footer,
	input.nav-panel-switch:not(:checked)~header [id="session"],
	input.nav-panel-switch:not(:checked)~header h1>a, {
		width: 0;
		padding: 0;
		overflow: hidden;
		border: initial;
		opacity: 0;
		display: none;
	}
}

a[href="#secondary"] {
	display: none;
}

// @media (max-width: @sm) {
// 	a[href="#secondary"] {
// 		display: block;
// 		position: fixed;
// 		bottom: var(--spacing-broadest);
// 		width: 100%;
// 		background-color: var(--color-accent);
// 		height: var(--spacing-thin);
// 		&:after {
// 			content: "Contenu secondaire";
// 		}
// 		z-index: 10;
// 	}
// }

/* Actions container for directory tables in index pages --------*/
.page-index [id="primary"] {
	&>.insert,
	&>.actions {
		position: sticky;
		bottom: 0;
		margin: var(--standard-inner-rhythm);

		// display: flex;

		input, select {
			// flex-basis: max-content;
			// flex-grow: 0;
			// flex-shrink: 0;
			width: auto;
			// display: inline-block;

			+* {
				margin-left: var(--standard-inner-rhythm);
			}
		}
		
		/* Set smaller than standard font-size on form elements --------*/
		input, select, button {
			font-size: var(--text-small);
		}
	}

	.insert .actions {
		float: right;
	}
}


/* Minimal styles for the burger button --------*/
#btn-toggle-header-mobile {
	// color: var(--color-main-dark);
	&:hover {
		color: var(--color-accent);
	}

	@media (min-width: @sm){
		display: none;
	}
}

/* Version element --------*/
#version {
	font-size: var(--text-smaller);
	color: var(--color-main-light);
}