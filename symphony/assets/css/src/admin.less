/**
 * Symphony Admin Master Layout
 */

/* Less variables --------*/
@import "variables";

/* Master grid layout --------*/
body {
	display: grid;
	grid-template-areas: 
		"header context context session"
		"notifier notifier notifier notifier"
		"primary primary primary primary"
		"secondary secondary secondary secondary"
		"footer footer footer footer"
		"nav nav controls controls";
		grid-template-rows: 
			var(--spacing-broadest) 
			auto
			minmax(0, 1fr)
			auto
			auto 
			var(--spacing-broadest);
		grid-template-columns: min-content auto minmax(0, 1fr) auto;

/* Zap structural elements to get children on master grid --------*/
	>main, >header, >header>h1, >main>form {
		display: contents;
	}
	
	/* Master Layout Base --------*/
	>nav {
		max-width: 100%;
		overflow: auto;
	}

	>.notifier {
		grid-area: notifier;
	}

	>header>h1>a {
		grid-area: header;
		padding: var(--standard-inner-rhythm);
	}

	[id="session"] {
		grid-area: session;
	}

	>nav {
		grid-area: nav;
		padding: var(--standard-outer-rhythm);
		padding-top: var(--spacing-large);
		padding-left: calc(var(--standard-outer-rhythm) + var(--standard-inner-rhythm));
	}

	>footer {
		grid-area: footer;
		padding: var(--standard-outer-rhythm);
	}

	>aside {
		grid-area: context;
		padding: var(--standard-inner-rhythm);
		padding-left: var(--standard-outer-rhythm);
	}

	>main>form>* {
		position: relative;
	}

	[id="primary"],
	[id="secondary"] {
		display: flex;
		flex-direction: column;
	}

	[id="secondary"],
	>main>form~* {
		grid-area: secondary;
		border-left: 1px solid var(--color-ui);
		padding: var(--standard-outer-rhythm);
		scroll-padding-top: calc(var(--standard-outer-rhythm) * 2);
	}
	
	[id="primary"] {
		grid-area: primary;
		scroll-padding-top: calc(var(--standard-outer-rhythm) * 2);
	}


	[id="primary"]>[role="directory"] {
		flex-grow: 1;
	}

	[id="controls"] {
		grid-area: controls;
	}


	[id="context"],
	[id="nav"],
	[id="footer"],
	[id="session"],
	[id="header"],
	[id="controls"],
	[id="secondary"] {
		background-color: var(--backframe-background-color);
	}

	[id="context"] {
		z-index: 5;
	}

	.notifier {
		z-index: 6;
	}

	[id="controls"] {
		z-index: 7;
	}

	#btn-toggle-header-mobile {
		grid-area: nav;
	}
	
	/* Master Layout for Narrow Viewports --------*/
	@media (max-width: @md) {
		>nav {
			/* Fix the nav and fit the screen --------*/
			position: fixed;
			top: 0;
			right: 0;
			bottom: 0;
			left: 0;
			/* Graphics --------*/
			background-color: var(--backframe-background-color);
			padding: var(--standard-outer-rhythm);
			padding-top: var(--spacing-larger);
			z-index: 11;

			&:not(.is-opened) {
				opacity: 0;
				pointer-events: none;
			}
		}

		/* Create top bar --------*/
		[id="context"] {
			background-color: var(--backframe-background-color);
			z-index: 1;
		}

		/* Create bottom bar with grid-area items --------*/
		[id="controls"],
		#btn-toggle-header-mobile {

			/* Graphics --------*/
			background-color: var(--backframe-background-color);
			padding: var(--standard-inner-rhythm) var(--standard-outer-rhythm);
			border-top: 1px solid var(--color-ui);
			/* Make it stick to the bottom of the window --------*/
			position: sticky;
			bottom: 0;
			order: 3;
			/* Make sure we can align items --------*/
			display: flex;
			align-items: center;
			/* Make sure it's above the nav --------*/
			z-index: 12;
		}

		[id="controls"] {
			[name="action[save]"],
			.create {
				margin-right: auto;
			}
		}

		#btn-toggle-header-mobile {
			border-right: 1px solid var(--color-ui);
		}

		main>form>[id="primary"] {
			overflow: auto;
		}

		[id="controls"],
		[id="session"] {
			display: flex;
			justify-content: flex-end;
		}

		[id="session"]>ul {
			z-index: 2;
			bottom: auto;
			top: 100%;
		}

		>[id="footer"] {
			position: fixed;
			padding: var(--spacing-micro);
			bottom: var(--spacing-broadest);
			background-color: transparent;
		}
	}

	@media (min-width: @xs) {
		grid-template-areas: 
			"header header context session"
			"notifier notifier notifier notifier"
			"primary primary primary primary"
			"secondary secondary secondary secondary"
			"footer footer footer footer"
			"nav controls controls controls";
	}

	@media (min-width: @sm) {
		grid-template-areas: 
			"header header context session session"
			"notifier notifier notifier notifier notifier"
			"primary primary primary primary secondary"
			"nav controls controls controls controls";
		grid-template-rows: 
			var(--spacing-broadest) auto minmax(0,1fr) var(--spacing-broadest);
		grid-template-columns: min-content auto minmax(0, 1fr) auto auto;


		[id="secondary"],
		>main>form~* {
			border-left: 1px solid var(--color-ui);
			
			width: var(--sidebar-width);
			max-width: var(--sidebar-max-width);
		}
	}

	/* Deployed grid layout for larger windows  --------*/
	@media (min-width: @md) {
		height: 100vh;
		grid-template-rows: auto 0 1fr min-content;
		grid-template-columns: 
			auto 
			minmax(0, 1fr)
			auto
			max-content;
		grid-template-areas:
			"nav  	context 	secondary controls" 
			"nav		notifier secondary controls"
			"nav 		primary 	secondary controls"
			"footer 	primary 	secondary controls";

		>main>form>section {
			max-height: 100%;
			overflow: auto;
		}

		/* Make sure both these elements share height for jank free context collapsing --------*/
		>[id="context"],
		>header h1>a {
			min-height: var(--spacing-broadest);
			box-sizing: border-box;
		}

		>header h1>a {
			position: absolute;
			width: calc(var(--navigation-sidebar-width) + var(--standard-outer-rhythm) * 2 + var(--standard-inner-rhythm));
		}

		>nav {
			width: var(--navigation-sidebar-width);
			max-width: var(--navigation-sidebar-max-width);
		}

		>header [id="session"] {
			grid-area: footer;
			justify-self: end;
			margin-right: var(--standard-outer-rhythm);
		}

		>aside {
			border-left: 1px solid var(--color-ui);
			border-bottom: 1px solid var(--color-ui);
		}

		[id="controls"] {
			flex-direction: column;
			border-left: 1px solid var(--color-ui);
			padding: var(--standard-inner-rhythm);
			padding-top: var(--standard-outer-rhythm);
			
			/* Give vertical rhythm to interactive elements --------*/
			a, button {
				margin-bottom: var(--spacing-thinnest);
			}

			.delete {
				margin-top: auto;
			}

			[name="action[save]"],
			.create {
				margin-bottom: var(--standard-outer-rhythm);
			}
		}
	}


	/* Content publishing interface specifics --------*/
	&[id="publish"].page-single {
		
		/* Align page title with primary fields --------*/
		[id="breadcrumbs"] {
			&:after {
				content: "";
			}
			nav, &:after {
				flex-basis: 0;
				flex-grow: 1;
			}

			h2 {
				margin: 0 auto;
				flex-basis: var(--standard-field-max-width);
			}
		}

		
		[id="primary"],
		[id="secondary"] {

			>* {
				flex-shrink: 0;

				@media (min-width: @md) {
					/* Forced vertical spacing in scrolling parent --------*/
					&:first-child {
						margin-top: auto;
					}

					&:last-child {
						margin-bottom: auto;
					}
				}
			}


			.field {
				max-width: var(--standard-field-max-width);
				width: 100%;
				margin-left: auto;
				margin-right: auto;

			}

		}

		[id="primary"] {
			padding: 0 var(--standard-outer-rhythm);
			margin: 0 var(--spacing-thin);

			/* Center fields vertically if in small quantities --------*/
			&:before, &:after {
				content: "";
				display: block;
				height: calc(var(--standard-outer-rhythm) * 2);
				flex-shrink: 0;
			}

			@media (max-width: @sm) {
				&:last-of-type {
					min-height: 100%;
				}
			}

		}

		[id="secondary"] {
			@media (max-width: @sm) {
				box-sizing: border-box;
			}

		}
	}
}

/* Primary and secondary style variants --------*/
[id="primary"] {
	--standard-field-background-color: var(--primary-field-background-color);
}

[id="secondary"] {
	--standard-field-background-color: var(--secondary-field-background-color);
}

/* Panel display switches --------*/
input.nav-panel-switch,
input.context-panel-switch,
input.secondary-panel-switch {
	grid-area: primary;
	-webkit-appearance: none;
	appearance: none;
	display: flex;
	align-items: center;
	justify-content: center;
	position: relative;
	align-self: stretch;
	color: var(--color-main-lighter);
	font-size: var(--text-current);
	z-index: 2;
	// border: 1px solid transparent;

	&:hover {
		background-color: var(--color-accent-lighter);
		border-color: var(--color-main-lighter);
	}
}

[id="primary"] {
	padding-top: var(--standard-outer-rhythm);
	padding-left: var(--standard-outer-rhythm);
}

input.nav-panel-switch,
input.secondary-panel-switch {
	width: var(--spacing-thin);

}

input.context-panel-switch {
	height: var(--spacing-thin);
	
	&:checked:before {
	}

	&:not(:checked):before {
		transform: scaleY(-1);
	}

	/* Use left pointing and turn it up because up triangle character is ugly --------*/
	&:before {
		content: "◀";
		text-orientation: sideways;
		writing-mode: vertical-lr;
	}

	@media (max-width: @md) {
		display: none;
	}
}

input.nav-panel-switch {
	border-left: 1px solid var(--color-ui);

	&:checked:before {
		content: "◀";
	}

	&:not(:checked):before {
		content: "▶";
	}

	@media (max-width: @md) {
		display: none;
	}
}

input.secondary-panel-switch {
	justify-self: end;

	&:checked:before {
		content: "▶";
	}

	&:not(:checked):before {
		content: "◀";
	}

	@media (max-width: @sm) {
		display: none;
	}
}

@media (min-width: @sm) {
	input.secondary-panel-switch:not(:checked)~[id="secondary"],
	input.nav-panel-switch:not(:checked)~nav,
	input.nav-panel-switch:not(:checked)~footer,
	input.nav-panel-switch:not(:checked)~header [id="session"],
	input.nav-panel-switch:not(:checked)~header h1>a, {
		width: 0;
		padding: 0;
		overflow: hidden;
		border: initial;
		opacity: 0;
		display: none;
	}

	input.context-panel-switch:not(:checked)~[id="context"] {
		padding: 0;
		height: 0;
		min-height: 0;
		color: transparent;

		>:not(.tabs) {
			display: none !important;
		}
	}
}

a[href="#secondary"] {
	display: none;
}

/* Actions container for directory tables in index pages --------*/
.page-index [id="primary"] {
	&>.insert,
	&>.actions {
		position: sticky;
		bottom: 0;
		margin: var(--standard-inner-rhythm);
		margin-left: 0;

		input, select {
			width: auto;

			&+* {
				margin-left: var(--standard-inner-rhythm);
			}
		}
		
		/* Set smaller than standard font-size on form elements --------*/
		input, select, button {
			font-size: var(--text-small);
		}
	}

	.insert .actions {
		float: right;
	}
}


/* Minimal styles for the burger button --------*/
#btn-toggle-header-mobile {
	&:hover {
		color: var(--color-accent);
	}

	@media (min-width: @sm){
		display: none;
	}
}

/* Version element --------*/
#version {
	font-size: var(--text-smaller);
	color: var(--color-main-light);
}